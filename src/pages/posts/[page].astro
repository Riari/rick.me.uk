---
import type { GetStaticPathsOptions } from "astro";
import { loadAndFormatCollection } from "../../scripts/utils/collection";

import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Container from "../../components/Container.astro";
import Pagination from "../../components/Pagination.astro";
import PostCard from "../../components/PostCard.astro";
import RSSIcon from "../../components/Icons/RSSIcon.astro";

export async function getStaticPaths(options: GetStaticPathsOptions) {
    const posts = (await loadAndFormatCollection("posts")).sort(
        (a: any, b: any) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
    );

    return options.paginate(posts, { pageSize: 10 });
}

const { page } = Astro.props;
---

<Layout title="Posts">
    <Header title="Posts" />

    <div class="page">
        <Container maxWidth="900px">
            <div class="rss">
                <a href="/rss.xml" target="_blank"><RSSIcon style="vertical-align: -2px;" /> RSS</a>
            </div>

            <div class="posts">
                {page.data.map((post) => <PostCard post={post} withTags={true} />)}
            </div>

            <Pagination page={page} />
        </Container>
    </div>
</Layout>

<style lang="scss">
.page {
    padding-bottom: 2rem;
}

.rss {
    padding: 0 0 1rem 0;
    font-weight: 500;
    color: var(--color-foreground-muted-2);
    text-align: right;

    a {
        text-decoration: none;
    }
}
</style>
